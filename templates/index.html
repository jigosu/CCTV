<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLOv8 ì–¼êµ´ ì¸ì‹ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="../static/css/style.css"> <!-- CSS íŒŒì¼ ë§í¬ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery ì¶”ê°€ -->
</head>
<body>
    <div class="container">
        <div class="camera">
            <h1>ì‹¤ì‹œê°„ CCTV í™”ë©´</h1>
            <img src="{{ url_for('video_feed') }}" alt="Video Feed" style="width: 100%; height: auto; border-radius: 5px;"/>
            

        </div>
        
        <div class="list">
            <h2>ë°©ë¬¸ì ëª©ë¡</h2>
            <form id="search-form">
                <br>
                ê¸°ê°„ ì…ë ¥ : <input type="date" name="start_date" placeholder="ì‹œì‘ ë‚ ì§œ"> ~ 
                <input type="date" name="end_date" placeholder="ì¢…ë£Œ ë‚ ì§œ"><br>                
                ë°©ë¬¸ì ê²€ìƒ‰ : <input type="text" name="search_query" placeholder="ë°©ë¬¸ì">
                <button type="submit" class="w-btn-skin"><b>ê²€ìƒ‰ ğŸ”</b></button>
                <button class="w-btn-skin" id="refresh" ><b>ìƒˆë¡œê³ ì¹¨ ğŸ”„</b></button>
                
                
            </form>
            
            <div id="search-results"></div> <!-- ê²€ìƒ‰ ê²°ê³¼ë¥¼ í‘œì‹œí•  ì˜ì—­ -->            
            <ul id="image-list"> <!-- ê¸°ì¡´ ë°©ë¬¸ì ëª©ë¡ì„ ìœ„í•œ ID ì¶”ê°€ -->
                {% for image in images %}
                    <li class="image-item" data-image="{{ image[1] }}">
                        <strong>ë°©ë¬¸ ë‚ ì§œ:</strong> {{ image[2] }} <br>
                        <strong>ë°©ë¬¸ì:</strong> {{ image[3] }} <br>
                        <img src="../{{ image[1] }}" alt="Image" class="hidden-image" style="display: none; width: 50%; height: auto; border-radius: 10px; margin-top: 5px;"/>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // ê¸°ì¡´ ê²€ìƒ‰ ê¸°ëŠ¥
            $('#search-form').on('submit', function(event) {
                event.preventDefault(); // í¼ ì œì¶œ ê¸°ë³¸ ë™ì‘ ë°©ì§€
                var query = $('input[name="search_query"]').val(); // ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
                var startDate = $('input[name="start_date"]').val(); // ì‹œì‘ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
                var endDate = $('input[name="end_date"]').val(); // ì¢…ë£Œ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
                
                $.ajax({
                    url: '/search', // ê²€ìƒ‰ ìš”ì²­í•  URL
                    type: 'POST',
                    data: {
                        search_query: query,
                        start_date: startDate,
                        end_date: endDate
                    },
                    success: function(data) {
                        $('#image-list').html(data); // ê²€ìƒ‰ ê²°ê³¼ë¡œ ê¸°ì¡´ ëª©ë¡ì„ ì—…ë°ì´íŠ¸
                    },
                    error: function(error) {
                        console.error('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    }
                });
            });

            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            $('#refresh').on('click', function(event) {
                event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
                location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            });
    
            // li í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            $(document).on('click', '.image-item', function() {
                var $image = $(this).find('img'); // í´ë¦­í•œ liì˜ ìì‹ì¸ img ìš”ì†Œ ì„ íƒ
                $('.hidden-image').not($image).hide(); // ë‹¤ë¥¸ ì´ë¯¸ì§€ëŠ” ìˆ¨ê¹€
                $image.toggle(); // í´ë¦­í•œ ì´ë¯¸ì§€ë§Œ í† ê¸€ (ë³´ì´ê±°ë‚˜ ìˆ¨ê¸°ê¸°)
            });
        });
    </script>
</body>
</html>
